# Lantern - Architecture

## Overview

This diagram shows this project's components at a high level and the project interacts with other systems:

![Architecture Diagram](/docs/img/architecture-wide.png)

This diagram shows this project's components at lower and more detailed level:

![Architecture Diagram](/docs/img/architecture-narrow.png)

## Catalogue application

The Data Catalogue is managed by a Python application within the `src/lantern` package.

It consists of:

- a [Config](/docs/config.md) class
- a Logging class
- data class models for [Records](/docs/data-model.md#records), [Items](/docs/data-model.md#items), etc.
- [Store](#stores) classes
- [Exporter](#exporters) classes
- resources for the [Static Site](/docs/site.md), inc. page templates, styles, scripts, etc.

## Static site

A static website forms the output of this project. It is generated by the [Static Site Exporter](#exporters).

A static site is used over a dynamic site for simplicity, reliability and performance. As the number of Records
increases, or if restricted metadata records (rather than resources) are needed, this approach may change.

See the [Static site](/docs/site.md) docs for information about the site structure.

## Stores

Stores create, update, read and delete Records in remote systems. They provide the Records to build the
[Static Site](#static-site) and persist new or updated Records for use in future builds.

Currently, a [GitLab](#gitlab) based store is used. See the [Stores](/docs/stores.md) docs for more information.

## Exporters

Exporters create different parts of the [Static Site](#static-site), such as Item pages, general resources such as CSS
and endpoints intended for programmatic consumption.

See the [Exporters](/docs/exporters.md) docs for more information.

## Record editors

Editors create and update Record configurations. They may be interactive (for use by humans to author bespoke Records),
or automated systems managing sets of Records for a particular purpose.

In either case, Record configurations are loaded into the Catalogue and then persisted via a [Store](#stores).

## GitLab

The [BAS GitLab instance](https://gitlab.data.bas.ac.uk) is used to as a remote Records [Store](#stores) and change
tracking tool.

GitLab is used for:

- consistency with other projects (including the source code for this project)
- ease of hosting a Git repository (including via automated provisioning)
- (as a nice to have) providing a web interface to inspect file changes

See the [Infrastructure](/docs/infrastructure.md#gitlab) docs for information about the GitLab project used.

## Amazon S3

Amazon Web Services (AWS) [Simple Storage System (S3)](https://aws.amazon.com/s3/) is used to host the contents of the
[Static site](#static-site) using S3 bucket hosting, with a [CloudFront Distribution](https://aws.amazon.com/cloudfront/)
to enable HTTPS support using a custom domain.

AWS S3 is used as a web host for:

- its high availability
- support for server side redirects
- support for object metadata
- ease of automated provisioning

See the [Site Exporter](/docs/exporters.md#site-exporter) docs for how information is managed in S3.

See the [Static Site](/docs/site.md) docs for more information about what is stored in S3.

### Reverse proxying

The BAS IT general load balancer is used to reverse proxy the production CloudFront distribution such that its content
is accessible within the existing `data.bas.ac.uk` domain (which currently hosts the legacy Discovery Metadata System).

See `data_redirect.txt` in the load balancer config for proxied paths based on the [Static Site](#static-site).
