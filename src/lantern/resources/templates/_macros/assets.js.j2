{% macro script_sentry_feedback_widget(dsn) %}
document.addEventListener('DOMContentLoaded', () => {
  Sentry.init({
    dsn: '{{ dsn }}'
  });

  const form = document.getElementById('site-feedback');
  if (!form) return;

  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const submitBtn = form.querySelector('button[type="submit"], [type="submit"]');
    const successEl = document.getElementById('feedback-success');
    const errorEl = document.getElementById('feedback-error');

    if (typeof Sentry === 'undefined' || typeof Sentry.captureFeedback !== 'function') {
      submitBtn.classList.add('hidden');
      errorEl.classList.remove('hidden');
      throw new Error('Sentry is not available');
    }

    const formData = new FormData(e.target);
    const email = formData.get('feedback-email');
    const content = formData.get('feedback-content');

    Sentry.captureFeedback({
      email: email,
      message: content
    });
    submitBtn.classList.add('hidden');
    successEl.classList.remove('hidden');
  });
});
{% endmacro %}

{% macro script_plausible() %}
window.plausible=window.plausible||function(){(plausible.q=plausible.q||[]).push(arguments)},plausible.init=plausible.init||function(i){plausible.o=i||{}};
plausible.init()
{% endmacro %}

{% macro script_show_js(selector) %}
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('.{{ selector }}').forEach(el => el.classList.remove('hidden'));
});
{% endmacro %}

{% macro script_sticky_tabs() %}
/* Based on jQuery Plugin Sticky Tabs by Aidan Lister <aidan@php.net> */
(function () {
  const selectTab = (tabId) => {
    const input = document.getElementById(tabId);
    if (input && input.type === "radio") {
      input.checked = true;
      window.history.pushState(null, null, `#${tabId}`);
    }
  };

  const handleHashChange = () => {
    const hash = window.location.hash;
    if (hash) {
      selectTab(hash.substring(1)); // Remove '#' from hash
    }
  };

  document.addEventListener("DOMContentLoaded", function () {
    handleHashChange(); // Handle initial hash on page load

    const tabLabels = document.querySelectorAll('label[for^="tab-"]');
    tabLabels.forEach((label) => {
      label.addEventListener("click", () => {
        const tabId = label.getAttribute("for");
        selectTab(tabId);
      });
    });

    // Listen for hash changes
    window.addEventListener("hashchange", handleHashChange);
  });
})();
{% endmacro %}

{% macro script_collapsible() %}
document.addEventListener('DOMContentLoaded', () => {
  // Find all elements with the `data-target` attribute and add click event listeners to hide/show a target element
  const toggles = document.querySelectorAll('[data-target]');

  toggles.forEach(toggle => {
    toggle.addEventListener('click', () => {
      const targetSelector = toggle.getAttribute('data-target');
      const targetElement = document.querySelector(targetSelector);
      if (targetElement) {
        targetElement.classList.toggle('hidden');
      }
    });
  });
});
{% endmacro %}

{% macro script_copyable() %}
document.addEventListener('DOMContentLoaded', () => {
  const writeToClipboard = async (text) => {
    if (navigator.clipboard && navigator.clipboard.writeText) {
      await navigator.clipboard.writeText(text);
    }
  };

  document.addEventListener('click', async (event) => {
    const trigger = event.target.closest('[data-copy]');
    if (!trigger) {
      return;
    }

    event.preventDefault();
    const value = trigger.getAttribute('data-copy');
    if (!value) {
      return;
    }

    try {
      await writeToClipboard(value);
      trigger.dispatchEvent(new CustomEvent('copy:success', { bubbles: true }));
    } catch (error) {
      trigger.dispatchEvent(new CustomEvent('copy:error', { bubbles: true, detail: error }));
    }
  });
});
{% endmacro %}
