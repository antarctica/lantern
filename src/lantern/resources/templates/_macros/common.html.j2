{% macro container_classes() %}container mx-auto{% endmacro %}

{% macro base_bg_text_classes() %}text-grey-900 dark:text-grey-100 bg-white dark:bg-grey-950{% endmacro %}

{% macro link_base_classes() %}underline{% endmacro %}

{% macro link_classes() %}{{ link_base_classes() }} text-sky-blue-500 dark:text-sky-blue-300{% endmacro %}

{% macro btn_base_classes() %}cursor-pointer{% endmacro %}

{% macro btn_default_classes() %}{{ btn_base_classes() }} bg-grey-100 text-black hover:bg-grey-300{% endmacro %}

{% macro btn_primary_classes() %}{{ btn_base_classes() }} bg-turquoise-500 text-white hover:bg-turquoise-700{% endmacro %}

{% macro btn_warning_classes() %}{{ btn_base_classes() }} bg-yellow-500 text-black hover:bg-yellow-700{% endmacro %}

{% macro footer_link_classes() %}{{ link_base_classes() }} text-sky-blue-300 dark:text-sky-blue-500{% endmacro %}

{% macro table_border_classes() %}border-grey-100 dark:border-grey-900{% endmacro %}

{% macro table_header_classes() %}p-2 font-bold border-b border-grey-500 dark:border-grey-300 bg-grey-100 dark:bg-grey-900{% endmacro %}

{% macro table_row_classes() %}p-2 border-b {{ table_border_classes() }}{% endmacro %}

{%  macro form_item_classes() %}w-full border-1 border-grey-300 dark:border-grey-500 dark:bg-grey-900 dark:text-white{% endmacro %}

{%  macro form_invalid_classes() %}user-invalid:border-red-500 user-invalid:border-2{% endmacro %}

{% macro maintenance_i_classes() %}fa-regular fa-screwdriver-wrench{% endmacro %}

{% macro back_to_top_id() %}site-top{% endmacro %}

{% macro feedback_widget_target() %}site-feedback{% endmacro %}

{% macro show_js_class() %}show-js{% endmacro %}

{% macro show_js_only() %}show-js hidden{% endmacro %}

{% macro feedback_trigger(classes, fallback, text) %}
  <noscript><a class="{{ classes }}" href="mailto:{{ fallback }}">{{ text }}</a></noscript>
  <button class="{{ show_js_only() }} cursor-pointer {{ classes }}" data-target="#{{ feedback_widget_target() }}">{{ text }}</button>
{% endmacro %}

{% macro prose() %}
  <div class="max-w-none prose prose-base dark:prose-invert prose-headings:font-bold prose-li:my-0">{{ caller() }}</div>
{% endmacro %}

{% macro dl_item(title, id, dd_class=None) %}
  <div class="space-y-2">
    <dt class="font-bold text-black dark:text-white">{{ title }}</dt>
    <dd {% if dd_class %}class="{{ dd_class }}"{% endif %} id="{{ id }}">{{ caller() }}</dd>
  </div>
{% endmacro %}

{% macro time(data, id=None) %}
  <time {% if id %}id="{{ id }}"{% endif %} datetime="{{ data.datetime }}">{{ data.value }}</time>
{% endmacro %}

{% macro copyable_path(value) %}
<div class="grid grid-cols-[minmax(0,1fr)_auto] gap-2 items-center">
  <div class="overflow-x-auto"><code class="whitespace-nowrap inline-block">{{ value }}</code></div>
  <button type="button" class="{{ show_js_only() }} p-2 {{ btn_default_classes() }}" data-copy="{{ value }}"><i class="fa-regular fa-copy"></i></button>
</div>
{% endmacro %}

{% macro restricted_i() %}<i class="fa-regular fa-lock-keyhole"></i>{% endmacro %}

{% macro ext_link_i() %}<i class="fa-regular fa-arrow-up-right-from-square"></i>{% endmacro %}

{% macro experimental_i() %}<i class="fa-regular fa-flask-round-potion"></i>{% endmacro %}

{% macro ext_link_a(href, value) %}
  <a class="{{ link_classes() }}" href="{{ href }}" target="_blank">{{ value }} {{ ext_link_i() }}</a>
{% endmacro %}

{% macro page_header(id_wrapper=None, id_sub=None, id_main=None, sub=None, sub_i=None, main=None) %}
  <header {% if id_wrapper %}id="{{ id_wrapper }}"{% endif %} class="pb-4 border-b-1 border-grey-100 dark:border-grey-900">
    {% if sub %}
      <small {% if id_sub %}id="{{ id_sub }}"{% endif %} class="text-grey-500 dark:text-grey-300 uppercase">
        {% if sub_i %}<i class="{{ sub_i }}"></i>{% endif %} {{ sub }}
      </small>
    {% endif %}
    <h1 {% if id_main %}id="{{ id_main }}"{% endif %} class="text-3xl">{{ main }}</h1>
  </header>
{% endmacro %}

{% macro img_light_dark(src_light, src_dark, alt_text, classes) %}
  <picture class="{{ classes }}">
    <source srcset="{{ src_light }}" media="(prefers-color-scheme: light)" />
    <source srcset="{{ src_dark }}" media="(prefers-color-scheme: dark)" />
    <img src="{{ src_light }}" alt="{{ alt_text }}" />
  </picture>
{% endmacro %}

{% macro form_label(for, label) %}
  <label class="block font-bold" for="{{ for }}">{{ label }}</label>
{% endmacro %}

{% macro form_input(id, name, value, placeholder, required) %}
  <div class="space-y-2">
    {{ form_label(for=id, label=name) }}
    <input
      class="{{ form_item_classes() }} {% if required %}{{ form_invalid_classes() }}{% endif %}"
      type="text" name="{{ id }}" id="{{ id }}"
      {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
      {% if value %}value="{{ value }}"{% endif %}
      {% if required %}required{% endif %}
    >
  </div>
{% endmacro %}

{% macro form_textarea(id, name, rows, placeholder, warning, required) %}
  <div class="space-y-2">
    {{ form_label(for=id, label=name) }}
    <textarea
      class="{{ form_item_classes() }} {% if required %}{{ form_invalid_classes() }}{% endif %}"
      name="{{ id }}" id="{{ id }}" rows="{{ rows }}"
      {% if placeholder %}placeholder="{{ placeholder }}"{% endif %}
      {% if required %}required{% endif %}
    ></textarea>
    {% if warning %}
      {% call alert(variant='yellow', classes="space-y-2") %}{{ warning }}{% endcall %}
    {% endif %}
  </div>
{% endmacro %}

{% macro item_border(classes="") %}
  <div class="p-2 border-1 border-grey-100 dark:border-grey-700 {{ classes }}">
    {{ caller() }}
  </div>
{% endmacro %}

{% macro item_title() %}
  <h2 class="text-2xl">{{ caller() }}</h2>
{% endmacro %}

{% macro item_summary(item) %}
  {% call item_border(classes="p-2 flex flex-col h-full") %}
    <div class="flex h-full">
      <div class="w-1/6 shrink-0 self-center">
        {{ img_light_dark(
          item.href_graphic[0],
          item.href_graphic[1],
          "thumbnail for " + item.title_plain,
          "w-full h-auto object-contain"
        ) }}
      </div>
      <div class="w-5/6 flex flex-col h-full pl-2">
        <header><a class="text-lg {{ link_classes() }}" href="{{item.href}}">{{ item.title_html }}</a></header>
        <article class="py-2 flex-grow overflow-auto">{% call prose() %}{{ item.summary_html }}{% endcall %}</article>
        <footer class="mt-auto flex items-center space-x-2 text-sm text-grey-500 dark:text-grey-300">
          {{ item_summary_fragments(item.fragments) }}
        </footer>
      </div>
    </div>
  {% endcall %}
{% endmacro %}

{% macro item_summary_fragment_divider() %}
  <span class="text-grey-100 dark:text-grey-700">|</span>
{% endmacro %}

{% macro item_summary_fragments(data) %}
  <span><i class="{{ data.item_type_icon }}"></i> {{ data.item_type }}</span>
  {% if data.edition %}
    {{ item_summary_fragment_divider() }}
    <span>{{ data.edition }}</span>
  {% endif %}
  {% if data.published %}
    {{ item_summary_fragment_divider() }}
    {{ time(data.published) }}
  {% endif %}
  {% if data.children %}
    {{ item_summary_fragment_divider() }}
    <span>{{ data.children }}</span>
  {% endif %}
  {% if data.restricted %}
    {{ item_summary_fragment_divider() }}
    <span>{{ restricted_i() }} Restricted</span>
  {% endif %}
{% endmacro %}

{% macro alert(variant, classes="") %}
  {% set variant_colour = "grey-500" %}
  {% if variant == "green" %}
    {% set variant_colour = "green-500" %}
  {% elif variant == "yellow" %}
    {% set variant_colour = "yellow-500" %}
  {% elif variant == "red" %}
    {% set variant_colour = "red-500" %}
  {% elif variant == "blue" %}
    {% set variant_colour = "sky-blue-500" %}
  {% elif variant == "purple" %}
    {% set variant_colour = "mauve-500" %}
  {% endif %}
  <div class="p-4 pr-0 border-l-5 border-l-{{ variant_colour }} {{ classes }}">
    {{ caller() }}
  </div>
{% endmacro %}
